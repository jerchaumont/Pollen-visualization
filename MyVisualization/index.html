<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualitation de données polliniques</title>
    <style>
        svg{
            background-color: lightgray;
        }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.4.4/dist/d3.min.js"></script>
    <script>
        //création d'une constante pour largeur de l'espace svg
        const largeur = window.innerWidth;
        
        //ajouter et transformer les données
        d3.csv('pollen_tri.csv', function(d){
            return{
                // il faut spécifier que la date est bien une date (et non pas une simple variable numérique) au moyen de d3.timeParse
                date : d3.timeParse("%Y-%m-%d")(d.Date), 
                Ambrosia : +d.Ambrosia,
                Artemisia : +d.Artemisia,
                Asteraceae : +d.Asteraceae,
                Alnus : +d.Alnus,
                Betula : +d.Betula,
                Ericaceae : +d.Ericaceae,
                Carpinus: +d.Carpinus,
                Castanea: +d.Castanea,
                Quercus: +d.Quercus,
                Chenopodium: +d. Chenopodium,
                Cupressaceae : +d.Cupressaceae,
                Acer : +d.Acer,
                Fraxinus : +d.Fraxinus,
                Gramineae : +d.Gramineae,
                Fagus : +d.Fagus,
                Juncaceae : +d.Juncaceae,
                Aesculus : +d.Aesculus,
                Larix : +d.Larix,
                Corylus : +d.Corylus,
                Juglans : +d.Juglans,
                Umbellifereae : +d.Umbellifereae,
                Ulmus : +d.Ulmus,
                Urtica : +d.Urtica,
                Rumex : +d.Rumex,
                Populus : +d.Populus,
                Pinaceae : +d.Pinaceae,
                Plantago : +d.Plantago,
                Platanus : +d.Platanus,
                Salix : +d.Salix,
                Cyperaceae : +d.Cyperaceae,
                Filipendula : +d.Filipendula,
                Sambucus : +d.Sambucus,
                Tilia : +d.Tilia,
            }
        }).then(donnees =>{
            //vérifier que les données ont été importées au moyen de console.log
            console.log(donnees);
            
            // création espace svg. le background est spécifié dans le css
            let canevas1 = d3
            .select('body')
            .append('svg')
            .attr('width',largeur)
            .attr('height',400);
            
            //visualiser le set de données
            // ajouter l'axe des X, sous format de date
            let axeX = d3.scaleTime()
            .domain(d3.extent(donnees, function(d) {return d.Date;}))
            .range([ 100,window.innerWidth-100]);
            
            canevas1.append("g")
            .attr("transform", `translate(0, ${innerHeight - 200})`)
            .call(d3.axisBottom(axeX));
            
            // Ajouter l'axe des Y
            let axeY = d3.scaleLinear()
            .domain(donnees, function(d) {return d.Ambrosia;})
            .range([ window.innerHeight, 0]);
            canevas1.append("g")
            .call(d3.axisLeft(axeY));
            
            // ajouter des points
            let cercles = canevas1.selectAll("circle")
            .data(donnees)
            .enter()
            .append("circle")
            .attr("cx",d=>axeX(d.Date))
            .attr("cy",d=>axeY(d[1-10]))
            .attr("r",10)
        })
    </script>
</body>
</html>